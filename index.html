<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metins: Desafios Interativos do dia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
       @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Orbitron:wght&display=swap');
        :root {
            --color-primary: #8b5cf6; /* Indigo-500 */
            --color-secondary: #3b82f6; /* Blue-500 */        
        }
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        /* Estilos para Dark Mode (Padr√£o) */
        .dark-mode {
            background-color: #111827; /* Gray-900 */
            color: #e5e7eb; /* Gray-200 */
        }
        .dark-mode .card {
            background-color: #1f2937; /* Gray-800 */
        }
        .dark-mode .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        /* Estilos para Light Mode */
        .light-mode {
            background-color: #f9fafb; /* Gray-50 */
            color: #1f2937; /* Gray-800 */
        }
        .light-mode .card {
            background-color: white;
            border: 1px solid #e5e7eb;
        }
        .light-mode .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }
        
        .timer-glow {
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px var(--color-primary), 0 0 20px var(--color-primary);
        }
        .neon-border {
            border: 2px solid var(--color-primary);
            box-shadow: 0 0 10px var(--color-primary);
        }

        /* Destaque para o campo de nome */
        .name-focus {
            box-shadow: 0 0 15px #facc15; /* Yellow-400 */
            animation: pulse-name 1.5s infinite;
        }
        @keyframes pulse-name {
            0% { box-shadow: 0 0 5px #facc15; }
            50% { box-shadow: 0 0 15px #facc15; }
            100% { box-shadow: 0 0 5px #facc15; }
        }
    </style>
</head>
<body class="dark-mode">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // Adicionada importa√ß√£o do 'query' e 'orderBy' para a corre√ß√£o
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp, setLogLevel, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // =========================================================================
        // CONFIGURA√á√ÉO REAL DO PROJETO 'metins-quiz'
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyBxWFlxHFlDE0Uyiozrz275MJsm1VP6QjK",
            authDomain: "metins-64fff.firebaseapp.com",
            projectId: "metins-64fff",
            storageBucket: "metins-64fff.firebaseapp.com",
            messagingSenderId: "891946067847",
            appId: "1:891946067847:web:f87ad568ffe6ffa2a8d522",
            measurementId: "G-SLFE6LNCM8" 
        };
        
        // Inicializa√ß√£o
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        window.auth = auth; 
        
        setLogLevel('Debug');

        let userId = null;
        let dbReady = false;

        const SCORES_COLLECTION = "resultados"; 

        // -----------------------------------------------------------
        // 1. AUTENTICA√á√ÉO E INICIALIZA√á√ÉO
        // -----------------------------------------------------------

        async function authenticate() {
            try {
                // Autentica√ß√£o an√¥nima
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Erro na autentica√ß√£o:", error);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;  
                dbReady = true; 
                console.log("Usu√°rio pronto:", userId);
                loadRankingListener();
            } else {
                // Fallback para ID
                userId = crypto.randomUUID(); 
                dbReady = false; 
                console.warn("Autentica√ß√£o pendente ou falhou. Ranking indispon√≠vel.");
            }
            
            document.getElementById('user-id').textContent = `ID: ${userId.substring(0, 8)}`;
        });

        // -----------------------------------------------------------
        // 2. L√ìGICA DO RANKING (FIRESTORE)
        // -----------------------------------------------------------

        window.saveScore = async (score) => {
            if (!dbReady) {
                console.error("Firestore n√£o est√° pronto. Verifique a autentica√ß√£o.");
                return;
            }
            
            const finalUserName = window.playerName || `Jogador ${userId.substring(0, 4)}...`;

            const playerDoc = {
                userId: userId,
                userName: finalUserName, 
                score: score, 
                timestamp: serverTimestamp(),
                date: new Date().toISOString().split('T')[0] 
            };
            
            window.lastSubmittedName = finalUserName;

            try {
                await addDoc(collection(db, SCORES_COLLECTION), playerDoc);
                console.log("Pontua√ß√£o da sess√£o salva com sucesso!");
            } catch (e) {
                console.error("Erro ao adicionar documento: ", e);
            }
        };

        // <<<<<<<<<<<<<<<<<<<< FUN√á√ÉO DE CARREGAMENTO DO RANKING CORRIGIDA >>>>>>>>>>>>>>>>>>>>
        function loadRankingListener() {
            if (!dbReady) return;
            
            // 1. Cria a consulta (query) ordenando os resultados diretamente no Firestore
            // A ordena√ß√£o por score √© crucial e exige o √çndice Composto no Firebase.
            const q = query(
                collection(db, SCORES_COLLECTION),
                orderBy("score", "desc"),    // Ordem principal: score (maior para o menor)
                orderBy("userName", "asc")   // Ordem secund√°ria (desempate): nome
            );
            
            // 2. Listener em tempo real
            onSnapshot(q, (snapshot) => {
                const allScores = [];
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    // O campo que voc√™ salva √© 'score', ent√£o o filtro √© por 'score'.
                    if (data.score !== undefined) {
                           allScores.push({ id: doc.id, ...data });
                    }
                });
                // Os dados agora v√™m do Firestore j√° ordenados, mas ainda precisam ser filtrados
                // por data e agrupados por melhor score do dia na fun√ß√£o renderHallDaFama.
                renderHallDaFama(allScores);
            }, (error) => {
                console.error("Erro ao ouvir o ranking: ", error); 
                document.getElementById('ranking-list').innerHTML = `<p class="text-red-400">Erro ao carregar ranking. Verifique o console e o √≠ndice composto.</p>`;
            });
        }
        // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< FIM DA CORRE√á√ÉO >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

        function renderHallDaFama(scores) {
            const rankingList = document.getElementById('ranking-list');
            if (!rankingList) return;
            rankingList.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];

            // 1. Filtra apenas os scores do dia atual (usando o campo 'date' que voc√™ salva)
            const dailyScores = scores.filter(s => s.date === today);

            // 2. Agrupa pelo melhor score por usu√°rio (userId)
            const dailyUserScoresMap = dailyScores.reduce((acc, score) => {
                const currentBest = acc[score.userId] ? acc[score.userId].score : 0;

                // Salva a nova pontua√ß√£o se for maior (ou se for o nome rec√©m-enviado com pontua√ß√£o igual)
                if (score.score > currentBest || (score.userName === window.lastSubmittedName && score.score === currentBest)) {
                    acc[score.userId] = { 
                        score: score.score, 
                        userName: score.userName 
                    };
                }
                return acc;
            }, {});

            // 3. Converte para array e ordena novamente (garantia, mas j√° vem ordenado pela query)
            const rankedDaily = Object.values(dailyUserScoresMap)
                .sort((a, b) => b.score - a.score) 
                .slice(0, 10); 

            if (rankedDaily.length === 0) {
                rankingList.innerHTML = `<p class="text-gray-400 text-center py-4">Ningu√©m jogou hoje ainda. Seja o primeiro!</p>`;
                return;
            }

            // 4. Renderiza a lista
            rankedDaily.forEach((entry, index) => {
                const rankClass = index === 0 ? 'bg-yellow-500/20 text-yellow-300 font-bold neon-border' : 
                                         index === 1 ? 'bg-gray-400/20 text-gray-300' :
                                         index === 2 ? 'bg-amber-700/20 text-amber-500' : 'bg-gray-700/20 text-gray-300';
                
                const isLastPlayer = (entry.userName === window.lastSubmittedName);
                const userHighlight = isLastPlayer ? ' neon-border border-indigo-500' : '';

                rankingList.innerHTML += `
                    <li class="flex justify-between items-center p-3 rounded-lg transition duration-200 ${rankClass} ${userHighlight}">
                        <span class="w-1/12 text-center text-xl">${index + 1}¬∞</span>
                        <span class="w-8/12 truncate ${isLastPlayer ? 'text-indigo-400 font-bold' : ''}">${entry.userName} ${isLastPlayer ? '(Voc√™)' : ''}</span>
                        <span class="w-3/12 text-right font-orbitron text-lg">${entry.score} pts</span>
                    </li>
                `;
            });
        }

        window.addEventListener('load', authenticate);
    </script>
    
    <script>
        // Vari√°vel global para o nome (definida na Home)
        window.playerName = 'Jogador An√¥nimo';
        window.lastSubmittedName = 'Jogador An√¥nimo'; // Usado para destacar o √∫ltimo jogador no ranking
        
        let isDarkMode = true;
        let timerInterval;
        let timeRemaining = 180; // Dura√ß√£o total da sess√£o (3 minutos)
        let quizActive = false;
        
        let currentChallengeIndex = 0; // √çndice da pergunta atual na lista embaralhada
        let sessionChallenges = [];    // Lista de desafios embaralhados para a sess√£o
        let currentSessionScore = 0;   // Pontua√ß√£o da sess√£o atual
        const SCORE_PER_QUESTION = 100;
        const INITIAL_TIME = 180; 

        // Fun√ß√£o de embaralhamento Fisher-Yates
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Banco de Perguntas (MANTIDO)
        const CHALLENGES = [
            { id: 1, title: "O Enigma do Supermercado", question: "Se 4 ma√ß√£s custam R$ 8,00, e voc√™ tem R$ 15,00, quantas ma√ß√£s voc√™ pode comprar no m√°ximo? (Responda o n√∫mero de ma√ß√£s)", answer: 7 },
            { id: 2, title: "O C√≥digo da Reuni√£o", question: "Se a reuni√£o come√ßa √†s 9:30 e dura 45 minutos, a que horas (em minutos ap√≥s a hora cheia) ela termina? (Responda apenas o minuto)", answer: 15 },
            { id: 3, title: "A Regra dos Tr√™s Irm√£os", question: "Tenho 3 filhos. O primeiro tem o dobro da idade do segundo, e o terceiro tem 5 anos. Se a soma das idades √© 20, quantos anos tem o filho do meio? (Responda a idade)", answer: 5 },
            { id: 4, title: "O Desconto da Roupa", question: "Uma camisa custa R$ 100,00. Voc√™ consegue 20% de desconto. Se voc√™ pagar com uma nota de R$ 50,00, qual ser√° o seu troco? (Responda o valor em Reais, sem v√≠rgulas)", answer: 30 },
            { id: 5, title: "A Velocidade M√©dia", question: "Voc√™ dirige por 2 horas a 60 km/h. Quantos quil√¥metros voc√™ percorreu? (Responda apenas o n√∫mero)", answer: 120 },
            { id: 6, title: "A Pizza Dividida", question: "Uma pizza tem 8 fatias. Se 3 amigos comem 2 fatias cada um, quantas fatias sobram? (Responda o n√∫mero de fatias)", answer: 2 },
            { id: 7, title: "O Enigma do Alfabeto", question: "Quantas vogais (A, E, I, O, U) existem na palavra 'METINS'? (Responda o n√∫mero)", answer: 2 },
            { id: 8, title: "O Tempo de Viagem", question: "Um carro viaja a 60 km/h. Quantos quil√¥metros ele percorre em 3 horas? (Responda o n√∫mero)", answer: 180 },
            { id: 9, title: "O Enigma dos Planetas", question: "Quantos planetas existem no nosso Sistema Solar? (Responda o n√∫mero)", answer: 8 },
            { id: 10, title: "O Enigma do Tempo", question: "Quantos minutos existem em uma hora e meia? (Responda o n√∫mero)", answer: 90 },
            { id: 11, title: "O Desafio do Tri√¢ngulo", question: "Quantos lados tem um tri√¢ngulo? (Responda o n√∫mero)", answer: 3 },
            { id: 12, title: "A Conta R√°pida", question: "Qual √© o resultado de 10 + (5 * 2)? (Responda o n√∫mero)", answer: 20 },
            { id: 13, title: "C√°lculo Mental R√°pido I", question: "Qual √© o resultado de 15 - 8? (Responda o n√∫mero)", answer: 7 },
            { id: 14, title: "O dobro do n√∫mero", question: "Qual √© o dobro de 15? (Responda o n√∫mero)", answer: 30 },
            { id: 15, title: "Divis√£o F√°cil", question: "Se voc√™ dividir 50 por 2, qual √© o resultado? (Responda o n√∫mero)", answer: 25 },
            { id: 16, title: "Pares de Meias", question: "Quantos pares voc√™ pode formar com 16 meias? (Responda o n√∫mero)", answer: 8 },
            { id: 17, title: "Multiplica√ß√£o B√°sica", question: "Quanto √© 5 vezes 7? (Responda o n√∫mero)", answer: 35 },
            { id: 18, title: "Os Dias da Semana", question: "Quantos dias h√° em duas semanas? (Responda o n√∫mero)", answer: 14 },
            { id: 19, title: "Idade dos Irm√£os", question: "Se voc√™ tem 10 anos e seu irm√£o √© 2 anos mais velho, quantos anos ele tem? (Responda o n√∫mero)", answer: 12 },
            { id: 20, title: "O Peso do P√£o", question: "Se um padeiro faz 50 p√£es em uma hora, quantos p√£es ele faz em meia hora? (Responda o n√∫mero)", answer: 25 },
            { id: 21, title: "A Diferen√ßa de Idade", question: "Jo√£o tem 30 anos e Maria tem 22. Qual √© a diferen√ßa de idade entre eles? (Responda o n√∫mero)", answer: 8 },
            { id: 22, title: "M√∫ltiplos de 5", question: "Qual √© o pr√≥ximo m√∫ltiplo de 5 depois de 35? (Responda o n√∫mero)", answer: 40 },
            { id: 23, title: "As Quatro Esta√ß√µes", question: "Quantas esta√ß√µes existem no ano? (Responda o n√∫mero)", answer: 4 },
            { id: 24, title: "Ordem das Opera√ß√µes", question: "Qual o resultado de 2 * (4 + 6)? (Responda o n√∫mero)", answer: 20 },
            { id: 25, title: "Metade do Tempo", question: "Metade de 60 minutos √© igual a quantos minutos? (Responda o n√∫mero)", answer: 30 }
        ];
        
        /**
         * L√≥gica de navega√ß√£o: Oculta todas as views e mostra a view selecionada.
         */
        window.navigate = (viewId) => {
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.add('hidden');
                view.classList.remove('opacity-100');
            });
            
            const targetView = document.getElementById(`view-${viewId}`);
            if (targetView) {
                targetView.classList.remove('hidden');
                setTimeout(() => targetView.classList.add('opacity-100'), 10);
            }

            // A√ß√µes espec√≠ficas ao navegar
            if (viewId === 'desafio') {
                if (!quizActive) {
                    startQuizSession();
                }
            } else {
                stopTimer(); // Para o timer se sair do desafio
            }
        };

        /**
         * 1. Valida o nome na Home View.
         * 2. Se for v√°lido, armazena globalmente e navega para o Desafio.
         */
        window.startChallengeFromHome = () => {
            const nameInput = document.getElementById('home-player-name');
            const feedback = document.getElementById('name-feedback');
            const nameValue = nameInput.value.trim();

            if (nameValue.length < 2) {
                feedback.textContent = "‚ö†Ô∏è Por favor, digite seu nome ou apelido para continuar.";
                nameInput.classList.add('animate-pulse', 'border-red-500');
                setTimeout(() => {
                    nameInput.classList.remove('animate-pulse', 'border-red-500');
                }, 1000);
                return;
            }
            
            feedback.textContent = "";
            window.playerName = nameValue; // Armazena o nome globalmente
            navigate('desafio');
        };

        /**
         * Inicia a SESS√ÉO de Quiz: Reseta o estado, o timer e EMBARALHA as perguntas.
         */
        function startQuizSession() {
            // 1. Cria e embaralha a lista de desafios para a sess√£o
            sessionChallenges = shuffleArray([...CHALLENGES]);
            currentChallengeIndex = 0; // Come√ßa sempre do primeiro desafio embaralhado
            quizActive = true;
            timeRemaining = INITIAL_TIME;
            currentSessionScore = 0;
            
            // 2. Reseta o estado da UI e feedback
            document.getElementById('resposta').value = '';
            document.getElementById('quiz-area').classList.remove('hidden');
            document.getElementById('quiz-completed-message').classList.add('hidden');
            document.getElementById('next-challenge-area').classList.add('hidden');
            
            // 3. Carrega a primeira pergunta do array embaralhado
            loadNewQuestion();
            
            // 4. Inicia o Timer
            updateTimerDisplay(); 
            updateScoreDisplay();
            startTimer();
        }
        
        /**
         * Carrega a pr√≥xima pergunta da lista embaralhada da sess√£o.
         */
        function loadNewQuestion() {
            // 1. Verifica se todos os desafios foram conclu√≠dos
            if (currentChallengeIndex >= sessionChallenges.length) {
                endQuizSession("Parab√©ns! Voc√™ √© uma capivarinha inteligente!", false);
                return;
            }
            
            // 2. Pega o desafio da posi√ß√£o atual no array embaralhado
            const challenge = sessionChallenges[currentChallengeIndex];
            
            // Atualiza o conte√∫do do desafio
            document.getElementById('challenge-title').textContent = challenge.title;
            document.getElementById('challenge-question').innerHTML = `**Enigma:** ${challenge.question}`;
            
            // Limpa o campo de resposta
            document.getElementById('resposta').value = '';
            
            // Feedback de acerto (se houver)
            const feedbackEl = document.getElementById('question-feedback');
            feedbackEl.textContent = "Nova pergunta!";
            feedbackEl.classList.remove('text-red-400');
            feedbackEl.classList.add('text-green-400');
            setTimeout(() => { feedbackEl.textContent = ""; }, 1500);
        }

        /**
         * Reseta o jogo, autentica novo jogador e for√ßa a volta para a Home.
         */
        window.nextChallenge = async () => {
            // Re-autentica o usu√°rio para gerar um novo ID (simulando um novo jogador)
            const newAuth = window.auth; 
            if (newAuth) {
                try {
                    await newAuth.signInAnonymously(newAuth); 
                    console.log("Novo jogador an√¥nimo autenticado (se o ambiente permitir).");
                } catch (error) {
                    console.error("Erro ao autenticar novo jogador:", error);
                }
            }
            
            // Limpa o nome para o pr√≥ximo jogador digitar o seu
            document.getElementById('home-player-name').value = '';
            window.playerName = 'Jogador An√¥nimo'; // Limpa o nome interno tamb√©m
            window.lastSubmittedName = 'Jogador An√¥nimo'; // Limpa o destaque de ranking
            
            // Zera o quiz
            quizActive = false; 
            
            // Vai para a Home para que o pr√≥ximo jogador insira seu nome
            navigate('home');
        }

        /**
         * Inicia o Timer Regressivo da SESS√ÉO.
         */
        function startTimer() {
            stopTimer();
            timerInterval = setInterval(() => {
                if (timeRemaining > 0 && quizActive) {
                    timeRemaining--;
                    updateTimerDisplay();
                } else if (quizActive) {
                    // Tempo esgotado
                    endQuizSession("O tempo acabou!", false);
                }
            }, 1000);
        }
        
        /**
         * Para o Timer Regressivo.
         */
        function stopTimer() {
            clearInterval(timerInterval);
        }

        /**
         * Atualiza a exibi√ß√£o do Timer.
         */
        function updateTimerDisplay() {
            const minutes = String(Math.floor(timeRemaining / 60)).padStart(2, '0');
            const seconds = String(timeRemaining % 60).padStart(2, '0');
            document.getElementById('timer').textContent = `${minutes}:${seconds}`;
        }
        
        /**
         * Atualiza a exibi√ß√£o da Pontua√ß√£o.
         */
        function updateScoreDisplay() {
            document.getElementById('score').textContent = `${currentSessionScore}`;
        }

        /**
         * Envia a resposta da pergunta ATUAL.
         */
        window.submitQuiz = () => {
            if (!quizActive) return;

            const challenge = sessionChallenges[currentChallengeIndex]; // Pega o desafio da lista embaralhada
            const answerInput = document.getElementById('resposta');
            // Remove espa√ßos e converte para n√∫mero
            const userResponse = parseInt(answerInput.value.trim()); 
            const feedbackEl = document.getElementById('question-feedback');

            if (userResponse === challenge.answer) {
                // ACERTOU
                currentSessionScore += SCORE_PER_QUESTION;
                updateScoreDisplay();
                
                // Avan√ßa para a pr√≥xima pergunta e a carrega
                currentChallengeIndex++; 
                loadNewQuestion(); 
            } else {
                // ERROU
                feedbackEl.textContent = `Resposta incorreta. A resposta certa era: ${challenge.answer}`;
                feedbackEl.classList.remove('text-green-400');
                feedbackEl.classList.add('text-red-400');
                
                // Termina o jogo
                endQuizSession("Voc√™ errou!", true);
            }
        };

        /**
         * Finaliza a SESS√ÉO de Quiz e mostra o resultado.
         */
        function endQuizSession(reasonText, isMistake) {
            stopTimer();
            quizActive = false;
            
            // Salva a pontua√ß√£o final (se for maior que 0)
            if (currentSessionScore > 0 && window.saveScore) {
                window.saveScore(currentSessionScore);
            }
            
            // Esconde a √°rea do quiz
            document.getElementById('quiz-area').classList.add('hidden');
            
            // Mostra a mensagem de conclus√£o
            const completedMsg = document.getElementById('quiz-completed-message');
            completedMsg.classList.remove('hidden');
            document.getElementById('next-challenge-area').classList.remove('hidden'); // Exibe o bot√£o Pr√≥ximo Jogador
            
            document.getElementById('final-score-text').innerHTML = `
                <span class="text-2xl font-bold">${reasonText}</span><br>
                Pontua√ß√£o Final: ${currentSessionScore} Pontos!
            `;
            
            if (isMistake) {
                completedMsg.classList.remove('bg-green-500/20', 'text-green-300');
                completedMsg.classList.add('bg-red-500/20', 'text-red-300');
            } else {
                // Se o tempo acabou ou todas as perguntas foram feitas
                completedMsg.classList.remove('bg-red-500/20', 'text-red-300');
                completedMsg.classList.add('bg-green-500/20', 'text-green-300');
            }
            
            // Vai para o Hall da Fama para mostrar o ranking em tempo real (ap√≥s 3 segundos de feedback)
            setTimeout(() => {
                navigate('hall-da-fama');
                
                // Retorna automaticamente para a Home ap√≥s 5 segundos no Hall da Fama (Ciclo de Pr√≥ximo Jogador)
                setTimeout(() => {
                    window.nextChallenge(); // Reseta e navega para a Home
                }, 5000); 

            }, 3000);
        }
        
        /**
         * Configura os event listeners DOM que precisam esperar o carregamento.
         */
        function setupListeners() {
            document.getElementById('mode-toggle').addEventListener('click', () => {
                isDarkMode = !isDarkMode;
                const body = document.body;
                const sunIcon = document.getElementById('sun-icon');
                
                if (isDarkMode) {
                    body.classList.remove('light-mode');
                    body.classList.add('dark-mode');
                    sunIcon.classList.remove('text-gray-900');
                    sunIcon.classList.add('text-yellow-400');
                    sunIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />`;

                } else {
                    body.classList.remove('dark-mode');
                    body.classList.add('light-mode');
                    sunIcon.classList.remove('text-yellow-400');
                    sunIcon.classList.add('text-gray-900');
                    sunIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />`;
                }
            });
            
            // Listener do menu mobile
            document.querySelector('.md\\:hidden button[onclick="toggleMobileMenu()"]').addEventListener('click', toggleMobileMenu);
        }

        /**
         * Alterna a visibilidade do menu mobile.
         */
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Navega√ß√£o inicial para a Home e configura√ß√£o de listeners
        window.onload = () => {
            setupListeners(); // Adiciona listeners ap√≥s o DOM carregar
            navigate('home');
        };

    </script>
    
    <nav class="sticky top-0 z-50 bg-gray-800 dark-mode:bg-gray-800 shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-extrabold font-orbitron text-indigo-400 cursor-pointer" onclick="navigate('home')">METINS</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="navigate('home')" class="nav-link text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</button>
                        <button onclick="navigate('desafio')" class="nav-link text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Desafio da Semana</button>
                        <button onclick="navigate('hall-da-fama')" class="nav-link text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Hall da Fama</button>
                        <button onclick="navigate('sobre')" class="nav-link text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Sobre</button>
                    </div>
                </div>
                
                <div class="flex items-center">
                    <button id="mode-toggle" class="p-2 rounded-full hover:bg-gray-700 transition duration-150 mr-4">
                        <svg id="sun-icon" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </button>
                    <div class="md:hidden">
                        <button onclick="toggleMobileMenu()" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="navigate('home'); toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left">Home</button>
                <button onclick="navigate('desafio'); toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left">Desafio da Semana</button>
                <button onclick="navigate('hall-da-fama'); toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left">Hall da Fama</button>
                <button onclick="navigate('sobre'); toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left">Sobre</button>
            </div>
        </div>
    </nav>

    <main class="py-10">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            
            <div id="view-home" class="view-content transition duration-500 opacity-0 px-4">
                <div class="card p-8 rounded-xl shadow-2xl">
                    <h1 class="text-4xl font-extrabold text-indigo-400 mb-4 font-orbitron">Bem-vindo(a) ao METINS!</h1>
                    <p class="text-gray-400 mb-6">Teste sua velocidade de racioc√≠nio e concorra ao Hall da Fama di√°rio.</p>
                    
                    <h2 class="text-xl font-bold mb-4 text-yellow-400">Entre para Come√ßar</h2>
                    <div class="space-y-4">
                        <input type="text" id="home-player-name" placeholder="Digite seu nome ou apelido" class="name-focus w-full p-3 rounded-lg bg-gray-700 text-white border border-yellow-400 focus:outline-none" />
                        <p id="name-feedback" class="text-sm text-red-400"></p>
                        <button onclick="startChallengeFromHome()" class="btn-primary w-full p-3 rounded-lg font-bold text-lg hover:opacity-80 transition duration-150">
                            Iniciar Desafio de 3 Minutos!
                        </button>
                    </div>
                </div>
            </div>

            <div id="view-desafio" class="view-content hidden transition duration-500 opacity-0 px-4">
                <div class="flex justify-between items-center mb-6">
                    <div class="text-xl font-bold">
                        Pontua√ß√£o: <span id="score" class="text-green-400 font-orbitron">0</span> pts
                    </div>
                    <div class="text-2xl font-extrabold text-red-400 timer-glow neon-border p-2 rounded-lg">
                        <span id="timer">03:00</span>
                    </div>
                </div>

                <div id="quiz-area" class="card p-8 rounded-xl shadow-2xl">
                    <h2 id="challenge-title" class="text-2xl font-bold text-indigo-400 mb-3">O Enigma do Supermercado</h2>
                    <p id="challenge-question" class="text-xl mb-6">**Enigma:** Se 4 ma√ß√£s custam R$ 8,00, e voc√™ tem R$ 15,00, quantas ma√ß√£s voc√™ pode comprar no m√°ximo? (Responda o n√∫mero de ma√ß√£s)</p>

                    <input type="number" id="resposta" placeholder="Digite sua resposta (apenas o n√∫mero)" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none mb-4" onkeydown="if(event.key === 'Enter') submitQuiz()" />
                    
                    <p id="question-feedback" class="text-sm text-green-400 mb-4"></p>

                    <button onclick="submitQuiz()" class="btn-primary w-full p-3 rounded-lg font-bold text-lg hover:opacity-80 transition duration-150">
                        Responder e Pr√≥ximo Desafio
                    </button>
                </div>

                <div id="quiz-completed-message" class="hidden text-center p-8 mt-6 rounded-xl shadow-2xl bg-green-500/20 text-green-300">
                    <p id="final-score-text" class="text-xl"></p>
                </div>

                <div id="next-challenge-area" class="hidden text-center mt-6">
                    <p class="text-gray-400">Voltando para a Home em segundos...</p>
                </div>
            </div>

            <div id="view-hall-da-fama" class="view-content hidden transition duration-500 opacity-0 px-4">
                <div class="card p-8 rounded-xl shadow-2xl">
                    <h1 class="text-4xl font-extrabold text-yellow-400 mb-6 font-orbitron text-center">üèÜ Hall da Fama Di√°rio üèÜ</h1>
                    <p class="text-gray-400 mb-4 text-center">Os 10 jogadores com a maior pontua√ß√£o de hoje.</p>

                    <ul id="ranking-list" class="space-y-3">
                        <p class="text-xl text-gray-400 text-center">Carregando ranking...</p>
                        </ul>
                    
                    <div class="mt-8 pt-4 border-t border-gray-700 text-sm text-gray-500 text-center">
                        <p id="user-id">ID: N/A</p>
                    </div>
                </div>
            </div>

            <div id="view-sobre" class="view-content hidden transition duration-500 opacity-0 px-4">
                <div class="card p-8 rounded-xl shadow-2xl">
                    <h1 class="text-4xl font-extrabold text-indigo-400 mb-4">Sobre o Metins</h1>
                    <p class="text-gray-400 mb-4">O Metins √© uma plataforma de desafios interativos di√°rios projetada para testar seu racioc√≠nio l√≥gico e matem√°tico em velocidade.</p>
                    
                    <h2 class="text-2xl font-bold text-yellow-400 mb-3">Como Funciona:</h2>
                    <ul class="list-disc list-inside space-y-2 text-gray-300 ml-4">
                        <li>Voc√™ tem **3 minutos** para responder o m√°ximo de perguntas poss√≠vel.</li>
                        <li>Cada resposta correta vale **100 pontos**.</li>
                        <li>Se voc√™ errar, o desafio termina imediatamente.</li>
                        <li>Sua melhor pontua√ß√£o do dia ser√° registrada no **Hall da Fama Di√°rio**.</li>
                        <li>O sistema usa **login an√¥nimo** para registrar cada nova sess√£o de jogo.</li>
                    </ul>

                    <h2 class="text-2xl font-bold text-yellow-400 mt-6 mb-3">Tecnologia:</h2>
                    <p class="text-gray-300">Este projeto foi constru√≠do usando HTML, Tailwind CSS e Firebase (para autentica√ß√£o an√¥nima e o banco de dados Firestore para o ranking).</p>
                </div>
            </div>

        </div>
    </main>

</body>
</html>
